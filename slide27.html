<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Slide 27: The AI-Generated Code</title>
    <link rel="stylesheet" href="style.css">
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Prism.js for Code Highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-okaidia.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>

    <!-- Internal CSS for this slide only -->
    <style>
        .code-container {
            margin-top: 1.5rem;
            max-height: 400px; /* จำกัดความสูงให้มี scrollbar */
            overflow-y: auto; /* ทำให้ scroll ได้ */
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }
        
        /* Override Prism.js default margin */
        pre[class*="language-"] {
            margin: 0;
            border-radius: 10px;
        }

        .notice-box {
            background-color: #f8f7fa;
            border-left: 4px solid var(--primary-color);
            padding: 15px 20px;
            margin-top: 2rem;
            border-radius: 0 8px 8px 0;
        }
        .notice-box p {
            font-size: 1.1rem;
            margin: 0;
        }
    </style>
</head>
<body>

    <div class="slide-card">
        
        <div class="card-body">
            <h2>Quick Win: The Result</h2>
            <h1>ผลลัพธ์จาก AI: โค้ดมาแล้ว!</h1>
            <p class="subtitle">นี่คือตัวอย่างโค้ดที่ AI สร้างให้จาก Prompt ของเรา (โค้ดของคุณอาจต่างไปเล็กน้อย แต่โครงสร้างหลักควรจะคล้ายกัน)</p>

            <div class="code-container">
<pre><code class="language-javascript">
// This is a sample code generated by AI. Yours might be slightly different.

function onOpen() {
  SpreadsheetApp.getUi()
      .createMenu('AI Tools')
      .addItem('Summarize Drug Info', 'summarizeDrug')
      .addToUi();
}

function summarizeDrug() {
  const sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName("Drug Summarizer");
  const drugName = sheet.getRange("A2").getValue();

  if (drugName) {
    const prompt = `ในฐานะเภสัชกรคลินิก โปรดสรุปประเด็นสำคัญสำหรับให้คำปรึกษาผู้ป่วย (counseling points) ของยา '${drugName}' เป็นภาษาไทย ไม่เกิน 5 ข้อในรูปแบบ bullet points`;
    
    try {
      const summary = callGeminiAPI(prompt);
      sheet.getRange("B2").setValue(summary);
    } catch (e) {
      SpreadsheetApp.getUi().alert('Error calling AI: ' + e.toString());
    }
  } else {
    SpreadsheetApp.getUi().alert('Please enter a drug name in cell A2.');
  }
}

function callGeminiAPI(promptText) {
  const API_KEY = "YOUR_API_KEY_HERE"; // <-- สำคัญ! ต้องใส่ Key ของเราตรงนี้
  
  if (!API_KEY || API_KEY === "YOUR_API_KEY_HERE") {
    throw new Error("API Key is not set. Please set your API Key in the script.");
  }

  const url = "https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=" + API_KEY;

  const requestBody = {
    "contents": [{
      "parts": [{
        "text": promptText
      }]
    }]
  };

  const options = {
    'method': 'post',
    'contentType': 'application/json',
    'payload': JSON.stringify(requestBody),
    'muteHttpExceptions': true
  };

  const response = UrlFetchApp.fetch(url, options);
  const jsonResponse = JSON.parse(response.getContentText());
  
  if (jsonResponse.candidates && jsonResponse.candidates.length > 0) {
    return jsonResponse.candidates[0].content.parts[0].text;
  } else {
    // Log the full error response for debugging
    console.error("AI Error Response:", response.getContentText());
    throw new Error("Failed to get a valid response from the AI. Check the execution log for details.");
  }
}

</code></pre>
            </div>

            <div class="notice-box">
                <p><i class="fas fa-info-circle"></i> ไม่ต้องกังวลถ้ายังไม่เข้าใจโค้ดทั้งหมดนะครับ หน้าที่ของเราคือ "ติดตั้ง" และ "ตั้งค่า" ให้ถูกต้องก็พอ</p>
            </div>
        </div>

        <div class="card-footer">
            <a href="slide26.html" class="nav-button">ย้อนกลับ</a>
            <a href="slide28.html" class="nav-button">ไปขั้นตอนติดตั้งกัน</a>
        </div>
    </div>

</body>
</html>